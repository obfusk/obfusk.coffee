<!DOCTYPE html>

<html>
<head>
  <title>obfusk.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>obfusk.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <!-- {{{1 -->

<pre><code>File        : obfusk.coffee
Maintainer  : Felix C. Stegerman &lt;flx@obfusk.net&gt;
Date        : 2013-08-16

Copyright   : Copyright (C) 2013  Felix C. Stegerman
Licence     : GPLv2 or EPLv1</code></pre>
<!-- }}}1 -->

<p>functional programming library for js/coffee</p>
<p><a href="https://github.com/obfusk/obfusk.coffee">https://github.com/obfusk/obfusk.coffee</a></p>
<p>License: GPLv2 or EPLv1.</p>
<h2>underscore + exports + misc</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>U = <span class="keyword">this</span>._ || require <span class="string">'underscore'</span>
O = exports ? <span class="keyword">this</span>.obfusk ||= {}
misc = O.misc ||= {}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>miscellaneous</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>make first char of string uppercase</p>
<pre><code>misc.titleCase &#39;fOO&#39; # =&gt; &#39;FOO&#39;</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>misc.titleCase = <span class="function"><span class="title">titleCase</span></span> = (x) -&gt;
  x.charAt(<span class="number">0</span>).toUpperCase() + x.substr <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>quote words</p>
<pre><code>qw &#39;foo, bar baz&#39; # =&gt; [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.qw = <span class="function"><span class="title">qw</span></span> = (xs...) -&gt;
  xs.join(<span class="string">' '</span>).replace(<span class="regexp">/,/g,' ').split(/\s+/</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>throw Error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.error = <span class="function"><span class="title">error</span></span> = (x) -&gt; <span class="keyword">throw</span> <span class="keyword">new</span> Error x</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2>currying &amp; partial application</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>f.length (or f.arg_length if set)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.flen = <span class="function"><span class="title">flen</span></span> = (f) -&gt; f.arg_length ? f.length</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>reverse function arguments</p>
<pre><code>(frev f)(1,2,3) &lt;=&gt; f(3,2,1)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.frev = <span class="function"><span class="title">frev</span></span> = (f) -&gt;
  <span class="function"><span class="title">g</span></span> = (args...) -&gt; f U.clone(args).reverse()...
  g.arg_length = flen f; g</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>flip first two arguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.flip = <span class="function"><span class="title">flip</span></span> = (f) -&gt;
  <span class="function"><span class="title">g</span></span> = (x, y, args...) -&gt; f y, x, args...
  g.arg_length = flen f; g</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>fix number of function arguments</p>
<pre><code>g = fix f, 3  # takes exactly 3 arguments</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.fix = <span class="function"><span class="title">fix</span></span> = (f, n = flen(f)) -&gt;
  <span class="function"><span class="title">g</span></span> = (args...) -&gt;
    error <span class="string">"fix: #args != <span class="subst">#{n}</span>"</span> <span class="keyword">if</span> args.length != n
    f args.slice(<span class="number">0</span>, n)...
  g.arg_length = n; g</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <!-- {{{1 -->

<p>curry a function; the curried function take at least one argument at
a time, until it has either received n arguments in total, or
receives no arguments (if noargs = true); except, if strict = true,
then the curried function takes exactly one argument at a time</p>
<pre><code>f = (a,b,c,d=88,e=99) -&gt; a + b * c / d - e
g = curry f
g(1)(2,3)(4)(5)
g(2,3,4)()</code></pre>
<!-- }}}1 -->

            </div>
            
            <div class="content"><div class='highlight'><pre>O.curry = <span class="function"><span class="title">curry</span></span> = (f, n = flen(f), strict = <span class="literal">false</span>, noargs = <span class="literal">true</span>) -&gt;
  _curry f, n, strict, noargs, []

<span class="function"><span class="title">_curry</span></span> = (f, n, strict, noargs, xs) -&gt;                          <span class="comment"># {{{1</span>
  <span class="function"><span class="title">g</span></span> = (ys...) -&gt;
    error <span class="string">'curry: unary function'</span> <span class="keyword">if</span> strict &amp;&amp; ys.length != <span class="number">1</span>
    zs = xs.concat ys
    <span class="keyword">if</span> (noargs &amp;&amp; ys.length == <span class="number">0</span>) || zs.length &gt;= n
      f zs...
    <span class="keyword">else</span>
      _curry f, n, strict, noargs, zs
  g.curried = curry; g</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
               <!-- }}}1 -->

<p>curry + frev (noargs = false)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.rcurry = <span class="function"><span class="title">rcurry</span></span> = (f, n, strict) -&gt; curry frev(f), n, strict, <span class="literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>partial application</p>
<pre><code>f = (a,b,c,d) -&gt; [a,b,c,d]
g = partial f, 1, 2
g 3, 4  # =&gt; [1,2,3,4]</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.partial = <span class="function"><span class="title">partial</span></span> = (f, xs...) -&gt;
  <span class="function"><span class="title">g</span></span> = (ys...) -&gt; f xs.concat(ys)...
  g.arg_length = flen(f) - xs.length; g</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>partial application, from the right</p>
<pre><code>f = (a,b,c,d,e=99) -&gt; [a,b,c,d,e]
g = rpartial f, 3, 4, 88
h = rpartial (fix f, 4), 3, 4
g 1, 2  # =&gt; [1,2,3,4,88]
h 1, 2  # =&gt; [1,2,3,4,99]</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.rpartial = <span class="function"><span class="title">rpartial</span></span> = (f, xs...) -&gt;
  <span class="function"><span class="title">g</span></span> = (ys...) -&gt; f ys.concat(xs)...
  g.arg_length = flen(f) - xs.length; g</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2>overloaded arity</h2>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <!-- {{{1 -->

<p>creates a functions with overloaded arity; dispatches bases on
arguments.length; if no match is found, dispatches to the last
function with arity 0 (if any)</p>
<pre><code>f = overload (()              -&gt; 1),
             ((x)             -&gt; x),
             ((x, y)          -&gt; x + y),
             ((x, y, args...) -&gt; f (f x, y), args...)</code></pre>
<!-- }}}1 -->

            </div>
            
            <div class="content"><div class='highlight'><pre>O.overload = <span class="function"><span class="title">overload</span></span> = (fs...) -&gt;                              <span class="comment"># {{{1</span>
  d = <span class="literal">null</span>; t = {}
  <span class="keyword">for</span> f <span class="keyword">in</span> fs
    <span class="keyword">if</span> flen(f) == <span class="number">0</span>
      d = f
    <span class="keyword">else</span> <span class="keyword">if</span> t[flen f]
      error <span class="string">'overload: multiple functions with same (non-zero) arity'</span>
    t[flen f] ||= f
  (args...) -&gt;
    <span class="keyword">for</span> x <span class="keyword">in</span> [t[args.length], d]
      <span class="keyword">return</span> x args... <span class="keyword">if</span> x
    error <span class="string">'overload: no match found'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
               <!-- }}}1 -->


<h2>multimethods</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <!-- {{{1 -->

<p>creates a multimethod with optional default; you can add a new
method implementation to an existing multimethod with <code>.method</code>,
supplying a predicate and a function; alternatively you can use
<code>.withMethod</code> to create a new multimethod with the implementation
added; also, <code>.methodPre</code> and <code>.withMethodPre</code> add the new
implementation at the front instead of the back so the predicate
will be checked before the existing ones</p>
<pre><code>neg = multi((x) -&gt; &#39;default&#39;)
  .method ((x) -&gt; typeof x == &#39;number&#39;),
          ((x) -&gt; -x)
  .method ((x) -&gt; typeof x == &#39;boolean&#39;),
          ((x) -&gt; !x)</code></pre>
<!-- }}}1 -->

            </div>
            
            <div class="content"><div class='highlight'><pre>O.multi = <span class="function"><span class="title">multi</span></span> = (f = <span class="literal">null</span>) -&gt; _multi [], f

<span class="function"><span class="title">_multi</span></span> = (fs, def) -&gt;                                           <span class="comment"># {{{1</span>
  <span class="function"><span class="title">find</span></span> = (args...) -&gt;
    <span class="keyword">for</span> f <span class="keyword">in</span> fs
      <span class="keyword">return</span> f.f <span class="keyword">if</span> f.p args...
    <span class="keyword">return</span> def
  <span class="function"><span class="title">g</span></span> = (args...) -&gt;
    <span class="keyword">if</span> (f = find(args...))? <span class="keyword">then</span> f args...
    <span class="keyword">else</span> error <span class="string">'multi: no match found'</span>
  g.find          = find
  g.<span class="function"><span class="title">method</span></span>        = (p, f) -&gt; fs.push     p: p, f: f; g
  g.<span class="function"><span class="title">methodPre</span></span>     = (p, f) -&gt; fs.unshift  p: p, f: f; g
  g.<span class="function"><span class="title">withMethod</span></span>    = (p, f) -&gt; _multi fs.concat([p: p, f: f]), def
  g.<span class="function"><span class="title">withMethodPre</span></span> = (p, f) -&gt; _multi [p: p, f: f].concat(fs), def
  g</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
               <!-- }}}1 -->


<h2>lazy</h2>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>is this a lazy object?; see lazy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.isLazy = <span class="function"><span class="title">isLazy</span></span> = (x) -&gt; x.lazy == lazy</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>lazy object (thunk)</p>
<pre><code>a = lazy 42; b = lazy -&gt; 42; c = lazy a
d = lazy -&gt; console.log &#39;thunk!&#39;; 42
[a(),a(),b(),c(),d(),d()]
# =&gt; [42,42,42,42,42]; console.log is called only once</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.lazy = <span class="function"><span class="title">lazy</span></span> = (x) -&gt;                                          <span class="comment"># {{{1</span>
  <span class="keyword">return</span> x <span class="keyword">if</span> isLazy x
  f = <span class="keyword">if</span> U.isFunction x <span class="keyword">then</span> x <span class="keyword">else</span> -&gt; x
  v = <span class="literal">null</span>; e = <span class="literal">false</span>
  <span class="function"><span class="title">g</span></span> = -&gt; (v = f(); e = <span class="literal">true</span>) <span class="keyword">unless</span> e; v
  g.lazy = lazy; g</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
               <!-- }}}1 -->


<h2>ADTs</h2>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>algebraic data type; returns an object with <code>.ctor1</code>, ...; each
constructor creates an object using the supplied function, which is
extended with <code>.type</code>, <code>.ctor</code>, and <code>.isCtor1</code>, ...; see Maybe,
Either, List</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.data = <span class="function"><span class="title">data</span></span> = (ctors = {}) -&gt;                                 <span class="comment"># {{{1</span>
  type = {}
  <span class="keyword">for</span> k, v <span class="keyword">of</span> ctors
    <span class="keyword">do</span> (v, o = { ctor: k, type: type }) -&gt;
      <span class="keyword">for</span> k2, v2 <span class="keyword">of</span> ctors
        o[<span class="string">"is<span class="subst">#{titleCase k2}</span>"</span>] = k == k2
      type[k] = -&gt; U.extend {}, v(arguments...), o
  type</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
               <!-- }}}1 -->

<p>run the function matching the constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.match = <span class="function"><span class="title">match</span></span> = (x, f = {}) -&gt; f[x.ctor]? x</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2>Maybe</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Maybe type: optional value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.Maybe = Maybe = data
  Nothing: -&gt; {}
  Just: (x) -&gt; { value: x }

O.Nothing = Nothing = Maybe.Nothing
O.Just    = Just    = Maybe.Just</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2>Either</h2>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Either type: value with two possibilities</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.Either = Either = data
  Left:  (x) -&gt; { value: x }
  Right: (x) -&gt; { value: x }

O.Left  = Left  = Either.Left
O.Right = Right = Either.Right</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2>List</h2>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>List type: lazy list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.List = List = data
  Nil: -&gt; {}
  Cons: (h, t) -&gt; { head: h, tail: lazy t }

O.Nil   = Nil   = List.Nil
O.Cons  = Cons  = List.Cons</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>create a List from arguments</p>
<pre><code>list 1, 2, 3</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.list = <span class="function"><span class="title">list</span></span> = (x, xt...) -&gt;
  <span class="keyword">if</span> arguments.length == <span class="number">0</span> <span class="keyword">then</span> Nil() <span class="keyword">else</span> Cons x, -&gt; list xt...</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>create a list from arguments + tail</p>
<pre><code>cons 1, 2, 3, list(4, 5, 6)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>O.cons = <span class="function"><span class="title">cons</span></span> = (xs..., ys) -&gt;
  <span class="keyword">for</span> x <span class="keyword">in</span> U.clone(xs).reverse()
    ys = Cons x, ys
  ys</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2>List functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>List each</p>
<pre><code>List.each ((x) -&gt; console.log x), list(1,2,3)</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>List.<span class="function"><span class="title">each</span></span> = (f, xs) -&gt;
  <span class="keyword">loop</span>
    <span class="keyword">return</span> <span class="keyword">if</span> xs.isNil; f xs.head; xs = xs.tail()</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>List to Array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>List.<span class="function"><span class="title">toArray</span></span> = (xs) -&gt;
  ys = []; List.each ((x) -&gt; ys.push x), xs; ys</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>List length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>List.<span class="function"><span class="title">len</span></span> = (xs) -&gt; n = <span class="number">0</span>; List.each (-&gt; ++n), xs; n</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2>...</h2>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>...</p>
<!-- vim: set tw=70 sw=2 sts=2 et fdm=marker : -->


            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
